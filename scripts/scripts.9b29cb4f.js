"use strict";var PostedApp=angular.module("postedApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]);PostedApp.config(["$routeProvider",function(a){a.when("/posts",{templateUrl:"views/posts.html",controller:"PostsCtrl"}).when("/posts/:postId",{templateUrl:"views/showpost.html",controller:"PostViewCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"AuthenCtrl",resolve:{user:["Authen",function(a){return a.resolveUser()}]}}).when("/login",{templateUrl:"views/login.html",controller:"AuthenCtrl",resolve:{user:["Authen",function(a){return a.resolveUser()}]}}).when("/users/:userId",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).otherwise({templateUrl:"views/posts.html",controller:"PostsCtrl"})}]),PostedApp.constant("FIREBASE_URL","https://blistering-torch-4798.firebaseio.com/"),PostedApp.controller("PostsCtrl",["$scope","$location","Post","Authen",function(a,b,c,d){a.postList=c.all,a.user=d.user,a.post={url:"http://postscontroller.com",title:"FFF"},a.deletePost=function(a){c["delete"](a)}}]),PostedApp.controller("PostViewCtrl",["$scope","$routeParams","Post","Authen",function(a,b,c,d){a.eachPost=c.get(b.postId),a.comments=c.comments(b.postId),a.user=d.user,a.signedIn=d.signedIn,a.addComment=function(){if(a.commentText&&""!==a.commentText){var b={text:a.commentText,creator:a.user.profile.username,creatorUID:a.user.uid};a.comments.$add(b),a.commentText=""}},a.deleteComment=function(b){a.comments.$remove(b)}}]),PostedApp.factory("Post",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b),d=a(c.child("posts")).$asArray(),e={all:d,create:function(b){return d.$add(b).then(function(d){return a(c.child("user_posts").child(b.creatorUID)).$push(d.name()),d})},get:function(b){return a(c.child("posts").child(b)).$asObject()},"delete":function(a){return d.$remove(a)},comments:function(b){return a(c.child("comments").child(b)).$asArray()}};return e}]),PostedApp.controller("NavCtrl",["$scope","$location","Post","Authen",function(a,b,c,d){a.signedIn=d.signedIn,a.logout=d.logout,a.user=d.user,a.post={url:"http://initialload.com",title:"navcontroller"},a.submitPost=function(){a.post.creator=a.user.profile.username,a.post.creatorUID=a.user.uid,c.create(a.post).then(function(c){b.path("/posts/"+c.name()),a.post={url:"http://",title:""}})}}]),PostedApp.filter("hostnameUrl",function(){return function(a){var b=document.createElement("a");return b.href=a,b.hostname}}),PostedApp.factory("Authen",["$firebaseSimpleLogin","FIREBASE_URL","$rootScope","$firebase",function(a,b,c,d){var e=new Firebase(b),f=a(e),g={register:function(a){return f.$createUser(a.email,a.password)},createProfile:function(a){var b={username:a.username,md5_hash:a.md5_hash,email:a.email,location:a.location,twitter:a.twitter,website:a.website},c=d(e.child("profile"));return c.$set(a.uid,b)},login:function(a){return f.$login("password",a)},logout:function(){f.$logout()},resolveUser:function(){return f.$getCurrentUser()},signedIn:function(){return!!g.user.provider},user:{}};return c.$on("$firebaseSimpleLogin:login",function(a,b){console.log("logged in"),angular.copy(b,g.user),g.user.profile=d(e.child("profile").child(g.user.uid)).$asObject()}),c.$on("$firebaseSimpleLogin:logout",function(){console.log("logged out"),g.user&&g.user.profile&&g.user.profile.$destroy(),angular.copy({},g.user)}),g}]),PostedApp.controller("AuthenCtrl",["$scope","$location","Authen","user",function(a,b,c){c.signedIn()&&b.path("/"),a.login=function(){c.login(a.user).then(function(){b.path("/")},function(b){console.log("login with no email entries"),a.error=b.toString()})},a.register=function(){c.register(a.user).then(function(d){return c.login(a.user).then(function(){return d.username=a.user.username,d.location=a.user.location,d.twitter=a.user.twitter,d.website=a.user.website,c.createProfile(d)}).then(function(){b.path("/")})},function(b){a.error=b.toString()})}}]),PostedApp.service("Profile",["$window","FIREBASE_URL","$firebase","Post","$q",function(a,b,c,d,e){var f=new Firebase(b),g={get:function(a){return c(f.child("profile").child(a)).$asObject()},getPosts:function(a){var b=e.defer();return c(f.child("user_posts").child(a)).$asArray().$loaded().then(function(a){for(var c={},e=0;e<a.length;e++){var f=a[e].$value;c[f]=d.get(f)}b.resolve(c)}),b.promise}};return g}]),PostedApp.controller("ProfileCtrl",["$scope","$routeParams","Profile",function(a,b,c){var d=b.userId;a.profile=c.get(d),c.getPosts(d).then(function(b){a.posts=b})}]),PostedApp.controller("signInCtrl",["$scope","$location","Post","Authen",function(a,b,c,d){a.signedIn=d.signedIn,a.logout=d.logout,a.user=d.user,a.post={},a.submitPost=function(){a.post.creator=a.user.profile.username,a.post.creatorUID=a.user.uid,c.create(a.post).then(function(c){b.path("/posts/"+c.name()),a.post={url:"http://example.com",title:"Title Here"}})}}]);
